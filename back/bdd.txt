CREATE DATABASE IF NOT EXISTS conversa;
USE conversa;

CREATE TABLE users (
    userId INT AUTO_INCREMENT PRIMARY KEY,
    firstName VARCHAR(30) NOT NULL,
    lastName VARCHAR(30),
    email VARCHAR(40) NOT NULL UNIQUE,
    phoneNumber VARCHAR(15) NOT NULL UNIQUE,
    birthDate DATE,
    password VARCHAR(150) NOT NULL,
    sexe VARCHAR(1) NOT NULL,
    profile VARCHAR(20) NOT NULL DEFAULT 'user.png',
    answerOne VARCHAR(20) NOT NULL,
    answerTwo VARCHAR(40) NOT NULL,
    answerThree VARCHAR(30) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE conversation (
    conversationId INT AUTO_INCREMENT PRIMARY KEY,
    participantOne INT NOT NULL,
    participantTwo INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    state VARCHAR(10) NOT NULL DEFAULT 'open',
    FOREIGN KEY (participantOne) REFERENCES users(userId) ON DELETE CASCADE,
    FOREIGN KEY (participantTwo) REFERENCES users(userId) ON DELETE CASCADE
);

CREATE TABLE message (
    messageId INT AUTO_INCREMENT PRIMARY KEY,
    messageType VARCHAR(10) NOT NULL,
    messageContent TEXT,
    conversation INT NOT NULL,
    sender INT NOT NULL,
    iv TEXT,
    timeDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation) REFERENCES conversation(conversationId) ON DELETE CASCADE,
    FOREIGN KEY (sender) REFERENCES users(userId) ON DELETE CASCADE
);
